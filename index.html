<!DOCTYPE html>
<!-- saved from url=(0044)https://aexposit.github.io/webmidiautomator/ -->
<html lang="en">

<head>

    <style type="text/css">
        .button {
            color: #000000;
            font-family: sans-serif;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            border: 2px solid #cccccc;
            border-radius: 10px;
            padding: 10px 0;
            display: block;
        }

        .messagelog {
            background: #eeeeee;
            border: 2px solid #888888;
            border-radius: 10px;
            padding: 10px;
            height: 80%;
            overflow: auto;
        }

        .title {
            color: #777777;
            font-family: sans-serif;
        }

        div.scroll {
            width: 100px;
            height: 500px;
            overflow: scroll;
        }
    </style>
    <script>

        var myMidiAccess = null;
        var myMidiPorts = [];


        function printString(str) {
            var messagelog = document.getElementById('messagelog');
            messagelog.innerHTML += str + "\n";
            messagelog.scrollTop = messagelog.scrollHeight;
        }

        function initMidi() {

            if (window.navigator.requestMIDIAccess) {

                // Try to connect to the MIDI interface.
                window.navigator.requestMIDIAccess({ sysex: false }).then(onSuccess, onFailure);

            } else {
                console.log("Web MIDI API not supported!");
            }
        }

        function onSuccess(interface) {

            // Get the global MIDIAccess
            myMidiAccess = interface;

            interface.onstatechange = function (event) {
                var port = event.port;
                printString("| Port state change event | Name: " + port.name + " | Connection: " + port.connection + "| State:" + port.state);
                if (port.type == "input" && port.state == "connected") {
                    port.onmidimessage = function (event) {
                        onMessageReceived(event.data);
                    };
                }
            };


            // Grab an array of all available ports from maps
            var iter = myMidiAccess.inputs.values();
            for (var i = iter.next(); !i.done; i = iter.next()) {
                myMidiPorts.push(i.value);

            }

            var iter = myMidiAccess.outputs.values();
            for (var o = iter.next(); !o.done; o = iter.next()) {
                myMidiPorts.push(o.value);
            }


            // Grab an array of all available ports and initialise message listeners

            for (var portNum = 0; portNum < myMidiPorts.length; portNum++) {
                printString("| Port type: " + myMidiPorts[portNum].type + " | Port name: " + myMidiPorts[portNum].name + " | Connection: " + myMidiPorts[portNum].connection + " | State: " + myMidiPorts[portNum].state);
                if (myMidiPorts[portNum].type == "input") {
                    myMidiPorts[portNum].onmidimessage = function (event) {
                        onMessageReceived(event.data);
                    };
                }
            }


            function onMessageReceived(message) {
                printString("Message arrived");
            }



        }
        function onFailure(error) {
            console.log("Could not connect to the MIDI interface");
        }



    </script>
</head>

<body>

    <h1 class="title">MIDI input monitor</h1>
    <div>
        <pre id="messagelog" class="messagelog"></pre>
    </div>

    <button onclick="initMidi()">Init</button>

</body>

</html>
